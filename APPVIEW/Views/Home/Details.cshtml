@using System.Globalization;
@model APPDATA.Models.ProductDetail

@{
    ViewData["Title"] = "Details";
    Layout = "~/Views/Shared/_LayoutWeb.cshtml";
}

<!-- ================ start banner area ================= -->
<section class="blog-banner-area" id="blog">
    <div class="container h-100">
        <div class="blog-banner">
            <div class="text-center">
                <h1>Shop Single</h1>
                <nav aria-label="breadcrumb" class="banner-breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Shop Single</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</section>
<!-- ================ end banner area ================= -->
@if (TempData["mess"] != null)
{
    <div class="alert alert-warning">
        @TempData["mess"]
        <button type="button" class="close" data-dismiss="alert"><span>&times;</span></button>
    </div>
}
<!--================Single Product Area =================-->
<div class="product_image_area">
    <div class="container">
        <div class="row s_product_inner">
            <div class="col-lg-6">
                <div class="owl-carousel owl-theme s_Product_carousel  carousel slide autoplay ">
                    @{
                        var a = true;
                    }
                    @foreach (var pd in ViewBag.lspd)
                    {
                        @foreach (var img in ViewBag.Img)
                        {

                            if (img.IdProductdetail == pd.Id)
                            {
                                if (a)
                                {
                                    <div class="single-prd-item">
                                        <img class="img-fluid" src="~/images/@img.Name" alt="">
                                    </div>
                                    a = false;
                                }
                                else
                                {

                                    <div class="single-prd-item">
                                        <img class="img-fluid" src="~/images/@img.Name" alt="">
                                    </div>
                                }


                            }

                        }
                    }

                </div>
                <div class="voucher-container" style="margin-top: 15px">
                    <div class="voucher-list">
                        <form asp-controller="Home" asp-action="SaveVoucherForUser" method="post">
                            <ul class="voucher-list" style="list-style-type: none; padding: 0; margin: 0; display: inline-flex; flex-wrap: nowrap;">
                                @foreach (var vc in ViewBag.Voucher)
                                {
                                    <li class="voucher-item" style="background: #F5F5F5; border-radius: 5px; color: #FF6A6A">
                                        <a>Mã: @vc.Code - Giảm: @vc.Value% - Max: @vc.DiscountAmount VND</a>
                                        <input type="hidden" name="voucherId" value="@vc.Id" />
                                        <input type="submit" value="+" class="btn btn-light addVoucherButton" data-voucher-id="@vc.Id" style="margin-left: 5px; color: #FF6A6A"/>
                                        
                                    </li>
                                }
                            </ul>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-lg-5 offset-lg-1">
                <form asp-action="AddToCart" asp-controller="Cart">
                    <input hidden name="id" value="@Model.Id" />
                    <div class="s_product_text">

                        <h3>@Model.Name</h3>
                        <h2>@Model.Price.ToString("C0", new CultureInfo("vi-VN"))</h2>
                        <p>@Model.Desciption</p>

                        <ul class="list">


                            <li>
                                Sizes:


                                @{
                                    var lstS = new List<Guid>();
                                }
                                
                                @foreach (var pd in ViewBag.lspd)
                                {
                                    if (lstS.Any(c => c == pd.Id_Size))
                                    {
                                        continue;
                                    }
                                    @foreach (var item in ViewBag.Size)
                                    {
                                        if (pd.Id_Size == item.Id)
                                        {
                                            lstS.Add(pd.Id_Size);
                                            <div class="custom-control custom-radio custom-control-inline">
                                                <input type="radio" value="@item.Id" class="custom-control-input" id="@item.Id" name="size">
                                                <label class="custom-control-label" for="@item.Id">@item.Name</label>
                                            </div>

                                        }

                                    }
                                }

                            </li>

                            <li>
                                Colors:
                                @{
                                    var lstC = new List<Guid>();
                                }
                                @foreach (var pd in ViewBag.lspd)
                                {
                                    if (lstC.Any(c => c == pd.Id_Color))
                                    {
                                        continue;
                                    }
                                    @foreach (var item in ViewBag.Color)
                                    {
                                        if (pd.Id_Color == item.Id)
                                        {
                                            lstC.Add(pd.Id_Color);
                                            <div class="custom-control custom-radio custom-control-inline">
                                                <input type="radio" value="@item.Id" class="custom-control-input" id="@item.Id" name="color">
                                                <label class="custom-control-label" for="@item.Id">@item.Name</label>
                                            </div>

                                        }

                                    }
                                }
                            </li>


                        </ul>
                        <div class="product_count">
                            <label for="Soluong">Quantity:</label>
                            @* <button onclick="var result = document.getElementById('sst'); var sst = result.value; if( !isNaN( sst )) result.value++;return false;"
                            class="increase items-count" type="button"><i class="ti-angle-left"></i></button>*@
                            <input type="number" id="sst" size="2" value="1" title="Quantity:" class="input-text qty" min="0" max="@Model.Quantity" name="Soluong">
                            @*<button onclick="var result = document.getElementById('sst'); var sst = result.value; if( !isNaN( sst ) &amp;&amp; sst > 0 ) result.value--;return false;"
                            class="reduced items-count" type="button"><i class="ti-angle-right"></i></button>*@

                        </div>
                        <button type="submit" data-product-id="@Model.Id" class="button primary-btn">Add to Cart</button>
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>
<!--================End Single Product Area =================-->
<!--================Product Description Area =================-->
<section class="product_description_area">
    <div class="container">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Hướng dẫn chọn size</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile"
                   aria-selected="false">Description</a>
            </li>
            @*<li class="nav-item">
            <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact"
            aria-selected="false">Comments</a>
            </li>
            <li class="nav-item">
            <a class="nav-link " id="review-tab" data-toggle="tab" href="#review" role="tab" aria-controls="review"
            aria-selected="false">Reviews</a>
            </li>*@
        </ul>
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade" id="home" role="tabpanel" aria-labelledby="home-tab">
                <img style="width:100%" src="~/UserImage/chonize.jpg" />
                <img style="width:100%" src="~/UserImage/chonquan.webp" />
            </div>

            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                <div class="table-responsive">
                    <table class="table">
                        <tbody>
                            <tr>
                                <td>
                                    <h5>Color</h5>
                                </td>
                                <td>
                                    @{
                                        var lstC1 = new List<Guid>();
                                    }
                                    @foreach (var pd in ViewBag.lspd)
                                    {
                                        if (lstC1.Any(c => c == pd.Id_Color))
                                        {
                                            continue;
                                        }
                                        @foreach (var item in ViewBag.Color)
                                        {
                                            if (pd.Id_Color == item.Id)
                                            {
                                                lstC1.Add(pd.Id_Color);
                                                <h5 style="display: inline-block; margin-right: 10px;">@item.Name mmm</h5>

                                            }
                                        }
                                    }
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5>Size</h5>
                                </td>
                                <td>

                                    @{
                                        var lstS1 = new List<Guid>();
                                    }
                                    @foreach (var pd in ViewBag.lspd)
                                    {
                                        if (lstS1.Any(c => c == pd.Id_Size))
                                        {
                                            continue;
                                        }
                                        @foreach (var item in ViewBag.Size)
                                        {
                                            if (pd.Id_Size == item.Id)
                                            {
                                                lstS1.Add(pd.Id_Size);
                                                <h5 style="display: inline-block; margin-right: 10px;">@item.Name,</h5>
                                            }

                                        }
                                    }
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5> Category</h5>
                                </td>
                                <td>

                                    @{
                                        var lstca = new List<Guid>();
                                    }
                                    @foreach (var pd in ViewBag.lspd)
                                    {
                                        if (lstca.Any(c => c == pd.Id_Category))
                                        {
                                            continue;
                                        }
                                        @foreach (var item in ViewBag.Category)
                                        {
                                            if (pd.Id_Category == item.Id)
                                            {
                                                lstca.Add(pd.Id_Category);
                                                <h5 style="display: inline-block; margin-right: 10px;">@item.Name,</h5>
                                            }

                                        }
                                    }
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5>Material</h5>
                                </td>
                                <td>

                                    @{
                                        var lstMa = new List<Guid>();
                                    }
                                    @foreach (var pd in ViewBag.lspd)
                                    {
                                        if (lstMa.Any(c => c == pd.Id_Material))
                                        {
                                            continue;
                                        }
                                        @foreach (var item in ViewBag.Material)
                                        {
                                            if (pd.Id_Material == item.Id)
                                            {
                                                lstMa.Add(pd.Id_Material);
                                                <h5 style="display: inline-block; margin-right: 10px;">@item.Name,</h5>
                                            }

                                        }
                                    }
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5>Supplier</h5>
                                </td>
                                <td>

                                    @{
                                        var lstSu = new List<Guid>();
                                    }
                                    @foreach (var pd in ViewBag.lspd)
                                    {
                                        if (lstSu.Any(c => c == pd.Id_supplier))
                                        {
                                            continue;
                                        }
                                        @foreach (var item in ViewBag.Supplier)
                                        {
                                            if (pd.Id_supplier == item.Id)
                                            {
                                                lstSu.Add(pd.Id_supplier);
                                                <h5 style="display: inline-block; margin-right: 10px;">@item.Name,</h5>
                                            }

                                        }
                                    }
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <h5>Description</h5>
                                </td>
                                <td>

                                    <h5>@Model.Desciption</h5>

                                </td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>
            @*		<div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
            <div class="row">
            <div class="col-lg-6">
            <div class="comment_list">
            <div class="review_item">
            <div class="media">
            <div class="d-flex">
            <img src="img/product/review-1.png" alt="">
            </div>
            <div class="media-body">
            <h4>Blake Ruiz</h4>
            <h5>12th Feb, 2018 at 05:56 pm</h5>
            <a class="reply_btn" href="#">Reply</a>
            </div>
            </div>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
            commodo</p>
            </div>
            <div class="review_item reply">
            <div class="media">
            <div class="d-flex">
            <img src="img/product/review-2.png" alt="">
            </div>
            <div class="media-body">
            <h4>Blake Ruiz</h4>
            <h5>12th Feb, 2018 at 05:56 pm</h5>
            <a class="reply_btn" href="#">Reply</a>
            </div>
            </div>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
            commodo</p>
            </div>
            <div class="review_item">
            <div class="media">
            <div class="d-flex">
            <img src="img/product/review-3.png" alt="">
            </div>
            <div class="media-body">
            <h4>Blake Ruiz</h4>
            <h5>12th Feb, 2018 at 05:56 pm</h5>
            <a class="reply_btn" href="#">Reply</a>
            </div>
            </div>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
            commodo</p>
            </div>
            </div>
            </div>
            <div class="col-lg-6">
            <div class="review_box">
            <h4>Post a comment</h4>
            <form class="row contact_form" action="contact_process.php" method="post" id="contactForm" novalidate="novalidate">
            <div class="col-md-12">
            <div class="form-group">
            <input type="text" class="form-control" id="name" name="name" placeholder="Your Full name">
            </div>
            </div>
            <div class="col-md-12">
            <div class="form-group">
            <input type="email" class="form-control" id="email" name="email" placeholder="Email Address">
            </div>
            </div>
            <div class="col-md-12">
            <div class="form-group">
            <input type="text" class="form-control" id="number" name="number" placeholder="Phone Number">
            </div>
            </div>
            <div class="col-md-12">
            <div class="form-group">
            <textarea class="form-control" name="message" id="message" rows="1" placeholder="Message"></textarea>
            </div>
            </div>
            <div class="col-md-12 text-right">
            <button type="submit" value="submit" class="btn primary-btn">Submit Now</button>
            </div>
            </form>
            </div>
            </div>
            </div>
            </div>
            <div class="tab-pane fade show active" id="review" role="tabpanel" aria-labelledby="review-tab">
            <div class="row">
            <div class="col-lg-6">
            <div class="row total_rate">
            <div class="col-6">
            <div class="box_total">
            <h5>Overall</h5>
            <h4>4.0</h4>
            <h6>(03 Reviews)</h6>
            </div>
            </div>
            <div class="col-6">
            <div class="rating_list">
            <h3>Based on 3 Reviews</h3>
            <ul class="list">
            <li><a href="#">5 Star <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i
            class="fa fa-star"></i><i class="fa fa-star"></i> 01</a></li>
            <li><a href="#">4 Star <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i
            class="fa fa-star"></i><i class="fa fa-star"></i> 01</a></li>
            <li><a href="#">3 Star <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i
            class="fa fa-star"></i><i class="fa fa-star"></i> 01</a></li>
            <li><a href="#">2 Star <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i
            class="fa fa-star"></i><i class="fa fa-star"></i> 01</a></li>
            <li><a href="#">1 Star <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i><i
            class="fa fa-star"></i><i class="fa fa-star"></i> 01</a></li>
            </ul>
            </div>
            </div>
            </div>
            <div class="review_list">
            <div class="review_item">
            <div class="media">
            <div class="d-flex">
            <img src="img/product/review-1.png" alt="">
            </div>
            <div class="media-body">
            <h4>Blake Ruiz</h4>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            </div>
            </div>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
            commodo</p>
            </div>
            <div class="review_item">
            <div class="media">
            <div class="d-flex">
            <img src="img/product/review-2.png" alt="">
            </div>
            <div class="media-body">
            <h4>Blake Ruiz</h4>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            </div>
            </div>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
            commodo</p>
            </div>
            <div class="review_item">
            <div class="media">
            <div class="d-flex">
            <img src="img/product/review-3.png" alt="">
            </div>
            <div class="media-body">
            <h4>Blake Ruiz</h4>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            <i class="fa fa-star"></i>
            </div>
            </div>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
            commodo</p>
            </div>
            </div>
            </div>
            <div class="col-lg-6">
            <div class="review_box">
            <h4>Add a Review</h4>
            <p>Your Rating:</p>
            <ul class="list">
            <li><a href="#"><i class="fa fa-star"></i></a></li>
            <li><a href="#"><i class="fa fa-star"></i></a></li>
            <li><a href="#"><i class="fa fa-star"></i></a></li>
            <li><a href="#"><i class="fa fa-star"></i></a></li>
            <li><a href="#"><i class="fa fa-star"></i></a></li>
            </ul>
            <p>Outstanding</p>
            <form action="#/" class="form-contact form-review mt-3">
            <div class="form-group">
            <input class="form-control" name="name" type="text" placeholder="Enter your name" required>
            </div>
            <div class="form-group">
            <input class="form-control" name="email" type="email" placeholder="Enter email address" required>
            </div>
            <div class="form-group">
            <input class="form-control" name="subject" type="text" placeholder="Enter Subject">
            </div>
            <div class="form-group">
            <textarea class="form-control different-control w-100" name="textarea" id="textarea" cols="30" rows="5" placeholder="Enter Message"></textarea>
            </div>
            <div class="form-group text-center text-md-right mt-3">
            <button type="submit" class="button button--active button-review">Submit Now</button>
            </div>
            </form>
            </div>
            </div>
            </div>
            </div>*@
        </div>
    </div>
</section>
<!--================End Product Description Area =================-->
<!--================ Start related Product area =================-->
<section class="related-product-area section-margin--small mt-0">
    <div class="container">
        <div class="section-intro pb-60px">
            <p>Popular Item in the market</p>
            <h2>Top <span class="section-intro__style">Product</span></h2>
        </div>
        <div class="row mt-30">

            @{
                var lstP = new List<Guid>();
                var so = 0;
                @foreach (var ProD in ViewBag.PD)
                {
                    if (lstP.Any(c => c == ProD.Id_Product))
                    {
                        continue;
                    }
                    <div class="col-sm-6 col-xl-3 mb-4 mb-xl-0">
                        @foreach (var img in ViewBag.Img)
                        {
                            if (img.IdProductdetail == ProD.Id)
                            {
                                so++;
                                lstP.Add(ProD.Id_Product);
                                <div class="single-search-product d-flex">
                                    <a href="@Url.Action("Details","Home",new{id=ProD.Id })"><img src="~/images/@img.Name" alt=""></a>
                                    <div class="desc">
                                        <a href="@Url.Action("Details","Home",new{id=ProD.Id })" class="title">@ProD.Name</a>
                                        <div class="price">$@ProD.Price</div>
                                    </div>
                                </div>
                                if (so == 3)
                                {
                                    break;
                                }
                            }
                        }
                    </div>
                }
            }
        </div>
    </div>
@* </section>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const addButton = document.querySelector(".button.primary-btn");

        addButton.addEventListener("click", function (event) {
            event.preventDefault(); // Ngăn chặn hành vi mặc định của nút submit trong form

            const productId = document.querySelector("input[name='id']").value;
            const quantityInput = document.querySelector("input[name='Soluong']").value;
            const sizeInput = document.querySelector("input[name='size']").value;
            const colorInput = document.querySelector("input[name='color']").value;

            // Lấy giá trị số lượng từ input
            const quantity = quantityInput ? parseInt(quantityInput) : 1;

            const data = {
                id: productId,
                Soluong: quantity,
                size: sizeInput,
                color: colorInput
            };

            $.ajax({
                type: "POST",
                url: "/cart/AddToCart",
                data: data,
                success: function (response) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Thành công',
                        text: 'Sản phẩm đã được thêm vào giỏ hàng thành công!',
                        position: 'bottom-right',
                        showConfirmButton: false,
                        timer: 2000,
                        toast: true
                    });

                    // Cập nhật thông tin giỏ hàng trên trang (ví dụ: hiển thị số lượng sản phẩm trong giỏ hàng)
                    updateCartInfo(response);
                },
                error: function () {
                    Swal.fire({
                        icon: 'error',
                        title: 'Lỗi',
                        text: 'Có lỗi xảy ra khi thêm sản phẩm vào giỏ hàng.',
                        position: 'bottom-right',
                        showConfirmButton: false,
                        timer: 2000,
                        toast: true
                    });
                },
            });
        });

        // Hàm cập nhật thông tin giỏ hàng trên trang
        function updateCartInfo(response) {
            // Điều chỉnh logic cập nhật thông tin giỏ hàng tại đây
            // Ví dụ: hiển thị số lượng sản phẩm trong giỏ hàng
            const cartCountElement = document.getElementById("cart-count");
            if (cartCountElement) {
                cartCountElement.textContent = response.cartItemCount; // Thay đổi thành dữ liệu thực tế bạn nhận được từ server
            }
        }
    });
</script> *@

<!--================ end related Product area =================-->
    <script>
        $(document).ready(function () {
            $(".s_Product_carousel").owlCarousel({
                items: 1,
                loop: true,
                margin: 10,
                autoplay: true,
                autoplayTimeout: 5000, // Thời gian chờ giữa các lượt autoplay (ms)
                autoplayHoverPause: true // Tạm dừng khi di chuột qua
            });
        });
    </script>
